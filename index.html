<!DOCTYPE html>
<html>
<head>
  <!-- PWA Manifest -->
<link rel="manifest" href="manifest.json">

<!-- iOS Add to Home Screen -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Ashconsoles">

<!-- iOS Icons -->
<link rel="apple-touch-icon" sizes="180x180" href="/icon-180.png">

<!-- Theme -->
<meta name="theme-color" content="#0f172a">

  <meta charset="UTF-8">
  <title>Ashconsoles</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      padding: 20px;
    }
    a {
      color: #38bdf8;
      text-decoration: none;
    }
    li {
      margin: 8px 0;
    }
  </style>
</head>
<body>

<h2>All Pages</h2>
<ul id="pagesList">Loadingâ€¦</ul>

<script>
const username = "ashconsoles"; // ðŸ”´ change this
const list = document.getElementById("pagesList");

/* ðŸ”¥ FORCE HARD RELOAD ON EVERY VISIT (Web App Safe) */
if (performance.navigation.type === 2) {
  location.reload(true);
}

/* ðŸ§¹ CLEAR SERVICE WORKER CACHE (if exists) */
if ('caches' in window) {
  caches.keys().then(names => {
    names.forEach(name => caches.delete(name));
  });
}

/* ðŸ“„ FETCH PAGE TITLE WITH NO CACHE */
async function getPageTitle(repo) {
  try {
    const ts = Date.now(); // cache buster
const rawURL = `https://raw.githubusercontent.com/${username}/${repo}/index.html?ts=${ts}`;


    const res = await fetch(rawURL, {
      cache: "no-store",
      headers: {
        "Cache-Control": "no-cache"
      }
    });

    if (!res.ok) throw new Error();

    const html = await res.text();
    const match = html.match(/<title>(.*?)<\/title>/i);
    return match ? match[1].trim() : repo;
  } catch {
    return repo;
  }
}

/* ðŸš€ LOAD GITHUB PAGES (NO CACHE) */
async function loadPages() {
  list.innerHTML = "Loadingâ€¦";

  const ts = Date.now();
  const apiURL = `https://api.github.com/users/${username}/repos?per_page=100&ts=${ts}`;

  const repos = await fetch(apiURL, {
    cache: "no-store",
    headers: {
      "Cache-Control": "no-cache"
    }
  }).then(r => r.json());

  list.innerHTML = "";
  let found = false;

  for (const repo of repos) {
    if (repo.has_pages) {
      found = true;

      const title = await getPageTitle(repo.name);
      const pageURL = `https://${username}.github.io/${repo.name}/`;

      const li = document.createElement("li");
      li.innerHTML = `<a href="${pageURL}" target="_self">${title}</a>`;
      list.appendChild(li);
    }
  }

  if (!found) {
    list.innerHTML = "<li>No GitHub Pages found.</li>";
  }
}

loadPages();
</script>

  <script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js");
}
</script>



</body>
</html>
