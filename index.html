<!DOCTYPE html>
<html>
<head>
  <!-- PWA Manifest -->
<link rel="manifest" href="manifest.json">

<!-- iOS Add to Home Screen -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Ashconsoles">

<!-- iOS Icons -->
<link rel="apple-touch-icon" sizes="180x180" href="/icon-180.png">

<!-- Theme -->
<meta name="theme-color" content="#0f172a">

  <meta charset="UTF-8">
  <title>Ashconsoles</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      padding: 20px;
    }
    a {
      color: #38bdf8;
      text-decoration: none;
    }
    li {
      margin: 8px 0;
    }
  </style>
</head>
<body>

<h2>All Pages</h2>
<ul id="pagesList">Loadingâ€¦</ul>

<script>
const username = "ashconsoles";
const list = document.getElementById("pagesList");

/* ðŸ§¹ CLEAR SERVICE WORKER CACHE (optional but safe) */
if ('caches' in window) {
  caches.keys().then(names => {
    names.forEach(name => caches.delete(name));
  });
}

/* ðŸ“„ FETCH PAGE TITLE */
async function getPageTitle(repo) {
  const paths = [
    `https://raw.githubusercontent.com/${username}/${repo}/main/index.html`,
    `https://raw.githubusercontent.com/${username}/${repo}/master/index.html`,
    `https://raw.githubusercontent.com/${username}/${repo}/gh-pages/index.html`,
    `https://raw.githubusercontent.com/${username}/${repo}/docs/index.html`
  ];

  for (const path of paths) {
    try {
      const res = await fetch(`${path}?ts=${Date.now()}`, { cache: "no-store" });
      if (!res.ok) continue;

      const html = await res.text();
      const match = html.match(/<title>(.*?)<\/title>/i);
      if (match) return match[1].trim();
    } catch {}
  }

  return repo; // fallback
}


/* ðŸš€ LOAD GITHUB PAGES */
async function loadPages() {
  try {
    list.textContent = "Loadingâ€¦";

    const res = await fetch(
      `https://api.github.com/users/${username}/repos?per_page=100&ts=${Date.now()}`,
      { cache: "no-store" }
    );

    if (!res.ok) throw new Error("GitHub API error");

    const repos = await res.json();
    list.innerHTML = "";

    let found = false;

    for (const repo of repos) {
      if (repo.has_pages) {
        found = true;
        const title = await getPageTitle(repo.name);
        const url = `https://${username}.github.io/${repo.name}/`;

        const li = document.createElement("li");
        li.innerHTML = `<a href="${url}">${title}</a>`;
        list.appendChild(li);
      }
    }

    if (!found) {
      list.innerHTML = "<li>No GitHub Pages found.</li>";
    }

  } catch (e) {
    console.error(e);
    list.innerHTML = "<li>Failed to load pages.</li>";
  }
}

/* âœ… THIS WAS MISSING */
loadPages();
</script>


  <script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js");
}
</script>



</body>
</html>
