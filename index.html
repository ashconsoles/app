<!DOCTYPE html>
<html>
<head>
  <!-- PWA Manifest -->
<link rel="manifest" href="manifest.json">

<!-- iOS Add to Home Screen -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Ashconsoles">

<!-- iOS Icons -->
<link rel="apple-touch-icon" sizes="180x180" href="/icon-180.png">

<!-- Theme -->
<meta name="theme-color" content="#0f172a">

  <meta charset="UTF-8">
  <title>Ashconsoles</title>
  <style>
body {
  font-family: system-ui, Arial, sans-serif;
  background: #0f172a;
  color: #e5e7eb;
  padding: 16px;
}

#appsGrid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
  gap: 16px;
}

.app {
  text-align: center;
  text-decoration: none;
  color: #e5e7eb;
}

.app img {
  width: 72px;
  height: 72px;
  border-radius: 18px;
  object-fit: cover;
  background: #020617;
}

.app span {
  display: block;
  margin-top: 6px;
  font-size: 13px;
  line-height: 1.2;
  word-break: break-word;
}
</style>

</head>
<body>

<h2>All Pages</h2>
<div id="appsGrid">Loading‚Ä¶</div>

<script>
const username = "ashconsoles";
const list = document.getElementById("pagesList");



/* üìÑ FETCH PAGE TITLE */
const fallbackIcon =
  "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%23020417'/><text x='50%' y='55%' font-size='42' fill='%23fff' text-anchor='middle'>üåê</text></svg>";


function imageExists(url) {
  return new Promise(resolve => {
    const img = new Image();
    img.onload = () => resolve(true);
    img.onerror = () => resolve(false);
    img.src = url + "?ts=" + Date.now();
  });
}
  
async function getBestIcon(repo) {
  const base = `https://${username}.github.io/${repo}`;

  const icons = [
    `${base}/icon-512.png`,
    `${base}/icon-192.png`,
    `${base}/icon-180.png`,
    `${base}/favicon.ico`,
    `${base}/apple-touch-icon.png`
  ];

 for (const url of icons) {
    if (await imageExists(url)) return url;
  }

  return fallbackIcon;
}

async function getPageTitle(repo) {
  const paths = [
    `https://raw.githubusercontent.com/${username}/${repo}/main/index.html`,
    `https://raw.githubusercontent.com/${username}/${repo}/master/index.html`,
    `https://raw.githubusercontent.com/${username}/${repo}/gh-pages/index.html`,
    `https://raw.githubusercontent.com/${username}/${repo}/docs/index.html`
  ];

  for (const path of paths) {
    try {
      const res = await fetch(`${path}?ts=${Date.now()}`, { cache: "no-store" });
      if (!res.ok) continue;

      const html = await res.text();
      const match = html.match(/<title>(.*?)<\/title>/i);
      if (match) return match[1].trim();
    } catch {}
  }

  return repo;
}

/* üöÄ LOAD GITHUB PAGES */
async function loadPages() {
  const grid = document.getElementById("appsGrid");

  try {
    grid.textContent = "Loading‚Ä¶";

    const res = await fetch(
      `https://api.github.com/users/${username}/repos?per_page=100&ts=${Date.now()}`,
      { cache: "no-store" }
    );

    if (!res.ok) throw new Error();

    const repos = await res.json();
    grid.innerHTML = "";

    for (const repo of repos) {
      if (!repo.has_pages) continue;

      const [title, icon] = await Promise.all([
        getPageTitle(repo.name),
        getBestIcon(repo.name)
      ]);

      const url = `https://${username}.github.io/${repo.name}/`;

      const a = document.createElement("a");
      a.className = "app";
      a.href = url;

      a.innerHTML = `
        <img src="${icon}" alt="">
        <span>${title}</span>
      `;

      grid.appendChild(a);
    }

    if (!grid.children.length) {
      grid.textContent = "No Pages found.";
    }

  } catch (e) {
    console.error(e);
    grid.textContent = "Failed to load pages.";
  }
}

document.addEventListener("DOMContentLoaded", loadPages);

</script>


  <script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js");
}
</script>



</body>
</html>
